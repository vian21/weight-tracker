<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weight</title>

    <link rel="manifest" href="manifest.json">

    <meta name="theme-color" content="#4BCFFA">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link href="icon.png" sizes="225x225" rel="apple-touch-startup-image" />
    <meta name="theme-color" content="#4BCFFA">
    <link rel="apple-touch-icon" href="icon.png">

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('/sw.js').then(function (registration) {
                    // Registration was successful
                    console.log('ServiceWorker registration successful with scope: ', registration
                        .scope);
                }, function (err) {
                    // registration failed :(
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>

    <script src="main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<style>
    #chart {
        margin-top: 100px;
    }

    button {
        margin-top: 10px;
        border-radius: 40px;
        border: 0;
        font-size: 16px;
        padding: 12px;
        width: 80%;
        background-color: #3dc7f5;
        color: white;
        text-decoration: none;
    }
</style>

<body>
    <center>
        <a href="new.html">
            <button id="new">New</button>
        </a>
        <div>
            <canvas id="chart"></canvas>
        </div>

        <br><br><br>

        <button onclick="deleteLastRecord()">Delete Last</button>
        <button onclick="deleteFirstRecord()">Delet First</button>
    </center>
</body>

<script>
    let labels = [];
    let weight = [];

    const weightData = getData();
    weightData.map((data, key) => {
        labels.push(data[0]);
        weight.push(data[1]);
    })

    const data = {
        labels: labels,
        datasets: [{
            label: 'Weight',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: weight,
        }]
    }

    const config = {
        type: 'line',
        data: data,

    }

    const chart = new Chart(document.getElementById('chart'),
        config,
    )

    function deleteLastRecord() {
        let data = getData();

        //remove last record
        data.pop();

        if (updateStorage(data)) {
            chart.data.labels.pop();
            chart.data.datasets.forEach((dataset) => {
                dataset.data.pop();
            });
            chart.update()
            return true;
        } else {
            return false;
        }
    }

    function deleteFirstRecord() {
        let data = getData();

        //remove last record
        data.shift();

        if (updateStorage(data)) {
            chart.data.labels.shift();
            chart.data.datasets.forEach((dataset) => {
                dataset.data.shift();
            });
            chart.update()
            return true;
        } else {
            return false;
        }
    }
</script>

</html>